services:
  - type: web
    name: hr-bot-mechel
    env: python
    region: frankfurt
    plan: free
    autoDeploy: true
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      
      echo "=========================================="
      echo "üóÑÔ∏è  –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•"
      echo "=========================================="
      python force_init_db.py
      
      echo "=========================================="
      echo "üîç –ü–†–û–í–ï–†–ö–ê –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•"
      echo "=========================================="
      python -c "
      import sys
      sys.path.insert(0, '.')
      from config import config
      try:
          conn = config.get_db_connection()
          cur = conn.cursor()
          cur.execute('SELECT COUNT(*) FROM faq')
          count = cur.fetchone()[0]
          conn.close()
          print(f'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ FAQ: {count}')
          if count < 75:
              print('‚ùå –û–®–ò–ë–ö–ê: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ–Ω—å—à–µ 75 –∑–∞–ø–∏—Å–µ–π!')
              sys.exit(1)
          else:
              print('‚úÖ –£–°–ü–ï–•: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.')
      except Exception as e:
          print(f'‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}')
          sys.exit(1)
      "
    startCommand: python bot.py
    envVars:
      - key: BOT_TOKEN
        sync: false
        required: true
      - key: ADMIN_IDS
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: MEME_ENABLED
        value: "false"
      - key: FEEDBACK_ENABLED
        value: "true"
      - key: AUTO_SET_WEBHOOK
        value: "true"
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: hr-bot-mechel
          type: web
          property: url
      - key: PORT
        value: "10000"
    healthCheckPath: /health
    healthCheckInterval: 60
