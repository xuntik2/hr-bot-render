services:
  - type: web
    name: hr-bot-mechel
    env: python
    region: frankfurt
    plan: free
    autoDeploy: true
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt
      
      echo "üóÑÔ∏è  –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
      python force_init_db.py
      
      echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞..."
      python -c "
      import sys
      sys.path.insert(0, '.')
      from config import config
      conn = config.get_db_connection()
      cur = conn.cursor()
      cur.execute('SELECT COUNT(*) FROM faq')
      count = cur.fetchone()[0]
      conn.close()
      print(f'‚úÖ –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: {count}')
      if count < 75:
          print('‚ùå –û–®–ò–ë–ö–ê: –í –±–∞–∑–µ –º–µ–Ω—å—à–µ 75 –∑–∞–ø–∏—Å–µ–π!')
          sys.exit(1)
      else:
          print('üéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!')
      "
    startCommand: python bot.py
    envVars:
      - key: BOT_TOKEN
        sync: false
        required: true
      - key: ADMIN_IDS
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: MEME_ENABLED
        value: "false"
      - key: FEEDBACK_ENABLED
        value: "true"
      - key: AUTO_SET_WEBHOOK
        value: "true"
      - key: RENDER_EXTERNAL_URL
        fromService:
          name: hr-bot-mechel
          type: web
          property: url
      - key: PORT
        value: "10000"
    healthCheckPath: /health
    healthCheckInterval: 60
